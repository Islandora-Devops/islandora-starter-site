---
services:
  alpaca:
    container_name: ddev-${DDEV_SITENAME}-alpaca
    image: ${ISLANDORA_DOCKER_IMAGE_REPO}/alpaca:${ISLANDORA_DOCKER_IMAGE_TAG}
    expose:
      - 8181
      - 11213
    depends_on:
      - activemq
      - crayfish-homarus
      - crayfish-houdini
      - crayfish-hypercube
    environment:
      ALPACA_JMS_URL: tcp://ddev-${DDEV_SITENAME}-activemq:61616
      ALPACA_DERIVATIVE_HOMARUS_URL: http://ddev-${DDEV_SITENAME}-crayfish-homarus:8000/convert
      ALPACA_DERIVATIVE_HOUDINI_URL: http://ddev-${DDEV_SITENAME}-crayfish-houdini:8000/convert
      ALPACA_DERIVATIVE_OCR_URL: http://ddev-${DDEV_SITENAME}-crayfish-hypercube:8000/
      ALPACA_DERIVATIVE_FITS_URL: http://ddev-${DDEV_SITENAME}-crayfish-crayfits:8000/
      ALPACA_FCREPO_INDEXER_MILLINER_URL: http://ddev-${DDEV_SITENAME}-crayfish-milliner:8000/
      ALPACA_TRIPLESTORE_INDEXER_ENABLED: false
    labels:
      com.ddev.site-name: ${DDEV_SITENAME}
      com.ddev.approot: ${DDEV_APPROOT}
    external_links:
      - ddev-router:${DDEV_HOSTNAME}
    volumes:
      - ddev-global-cache:/mnt/ddev-global-cache
      - ./scripts/trust-certs:/usr/bin/trust-certs
    secrets:
      - ALPACA_ACTIVEMQ_PASSWORD
      - ALPACA_KARAF_ADMIN_PASSWORD
